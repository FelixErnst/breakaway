<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sample size calculations for alpha diversity • breakaway</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">breakaway</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/breakaway.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/alpha-better.html">alpha diversity, properly</a>
    </li>
    <li>
      <a href="../articles/betta-figure.html">Comparing samples visually with betta</a>
    </li>
    <li>
      <a href="../articles/resample-estimates.html">Variance of alpha diversity estimates</a>
    </li>
    <li>
      <a href="../articles/sample-size-calculations.html">Sample size calculations for alpha diversity</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Sample size calculations for alpha diversity</h1>
                        <h4 class="author">Amy Willis</h4>
            
            <h4 class="date">2017-10-05</h4>
          </div>

    
    
<div class="contents">
<p>This is a really quick introduction to using the sample size calculation tools provided in <code>breakaway</code>. It assumes reasonable familiarity with both <code>R</code> and <code>breakaway</code>.</p>
<div id="loading-the-package-and-your-data" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-the-package-and-your-data" class="anchor"></a>Loading the package and your data</h2>
<p>Download the latest version of the package from github.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">### Run the first two lines at home! ####
<span class="co"># install.packages("devtools")</span>
<span class="co"># devtools::install_github("adw96/breakaway")</span>
<span class="kw">library</span>(breakaway)</code></pre></div>
<p>Let’s consider some example OTU tables, taxonomy information, and covariate information.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#my_table &lt;- data(toy_otu_table)</span>
<span class="co">#my_taxonomy &lt;- data(toy_taxonomy)</span>
<span class="co">#meta &lt;- data(toy_metadata)</span></code></pre></div>
<p>Suppose we are interested in the species richness of cyanobacteria, and whether or not it changes with a cyanobacteria bloom event. (You could easily generalise this to toxin-forming genera, if that was your target of interest (Amy to <span class="citation">@Sarah</span>)…)</p>
<p>The data is probably noisy and so we may not have a strong enough signal to detect a difference in richness with bloom. The point of these tools is to help you find an <em>estimate</em> of how many samples you might need to detect such a difference.</p>
<p>First set up the species richness and bloom variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Find how many otus are in the cyanobacteria genus
cyano_nodes &lt;-<span class="st"> </span><span class="kw">apply</span>(toy_otu_table[<span class="kw">grepl</span>(<span class="st">"Cyano"</span>, toy_taxonomy), ], <span class="dv">2</span>, function(x) <span class="kw">sum</span>(x&gt;<span class="dv">0</span>))
cyano_nodes &lt;-<span class="st"> </span>cyano_nodes

bloom1 &lt;-<span class="st"> </span>toy_metadata[, <span class="st">"bloom2"</span>]
bloom &lt;-<span class="st"> </span>bloom1 ==<span class="st"> "yes"</span></code></pre></div>
<p>Let’s start by drawing a picture. Could a difference even be possible?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="dv">1</span>:<span class="kw">length</span>(bloom), <span class="kw">c</span>(cyano_nodes[bloom], cyano_nodes[!bloom]), 
     <span class="dt">pch=</span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">16</span>, <span class="kw">sum</span>(bloom)), <span class="kw">rep</span>(<span class="dv">1</span>, <span class="kw">sum</span>(!bloom)))) ## Hmmm ambiguous</code></pre></div>
<p><img src="sample-size-calculations_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<p>Fascinating! We observe much more low richnesses for non-bloom samples, but it’s really quite ambiguous.</p>
<p>An important consideration is that our samples are not exhaustive: each of these cyanobacteria richness values are estimated and not, in fact, correct. There almost certainly were more phyla present than we observed. Estimating the total phyla richness is a great problem for <code>breakaway</code>. Actually, it’s probably better for CatchAll, because there’s not that much richness (only around 20 phyla per sample). Let’s come back to estimating the total phyla richness another time and focus instead on finding the required sample size to detect a difference when there is noise.</p>
<p>I’m going to make a big leap now and pretend that I know that the standard deviation in the bloom richnesses is 2, and the standard deviation in non-bloom richnesses is 5. How would the above picture change? Sounds like a good problem for <code>betta_pic</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/betta_pic.html">betta_pic</a></span>(<span class="kw">c</span>(cyano_nodes[bloom], cyano_nodes[!bloom]), <span class="dt">se =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">2</span>, <span class="kw">sum</span>(bloom)), <span class="kw">rep</span>(<span class="dv">5</span>, <span class="kw">sum</span>(!bloom))), <span class="dt">mypch =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">16</span>, <span class="kw">sum</span>(bloom)), <span class="kw">rep</span>(<span class="dv">1</span>, <span class="kw">sum</span>(!bloom))))</code></pre></div>
<p><img src="sample-size-calculations_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<p>Ooooo, difficult! With this picture suggest a difference? Maybe. We definitely need more samples. I wonder how many? (That’s the point of this tutorial, FYI)</p>
<p>Why would the standard deviation change the necessary sample size? Let’s suppose that both groups have the same standard error. How do the differences between the groups change?</p>
<pre><code>##       Estimates Standard Errors p-values
##            19.1       0.7657131        0
## bloom       7.9       1.5939589        0</code></pre>
<pre><code>##       Estimates Standard Errors p-values
##            19.1        1.672484    0.000
## bloom       7.9        3.481553    0.023</code></pre>
<pre><code>##       Estimates Standard Errors p-values
##            19.1        2.926847    0.000
## bloom       7.9        6.092718    0.195</code></pre>
<p>So larger standard errors lead to less precise estimates. Note that the estimate of the difference (in phyla richnesses) between the groups doesn’t change, but its standard error does, which changes the p-value.</p>
<p>Okay, let’s start by estimating the standard errors as the within group standard deviations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sd</span>(cyano_nodes[bloom])</code></pre></div>
<pre><code>## [1] 6.919176</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sd</span>(cyano_nodes[!bloom])</code></pre></div>
<pre><code>## [1] 9.716108</code></pre>
<p>This is kind of primitive but not that bad to start.</p>
<p>I’d prefer to be conservative and choose a larger standard error… the maximum of both groups would suit me fine. So for my simulation I’m going to choose a standard error of 10, common to both groups. So I set <code>se_est = 10</code>.</p>
<p>Suppose that 6 more phyla is concerning, that is, a difference 6 in the of species richness is the difference I want to detect. So I set <code>diff = 6</code>.</p>
<p>For no good reason, suppose I want to test at the 5% level. <code>alpha = 0.05</code>.</p>
<p>Power of 80%? Why not?! <code>prop = 0.8</code> TODO: Amy to rename this to <code>power</code></p>
<p>I’ve got time to go make myself a coffee, and I care a lot about precision, so I will set <code>samples = 500</code>. Only have time for a sneeze? Set <code>samples = 100</code>. Big boozy lunch? <code>samples = 2000</code>. Scales linearly. It’s pretty fast! (No thanks to me…)</p>
<pre><code>## Power at a sample size of 5: 26.4%
## Power at a sample size of 6: 31.2%
## Power at a sample size of 7: 32.8%
## Power at a sample size of 8: 39.6%
## Power at a sample size of 9: 43.8%
## Power at a sample size of 10: 49.2%
## Power at a sample size of 11: 46.8%
## Power at a sample size of 12: 54.8%
## Power at a sample size of 13: 48.6%
## Power at a sample size of 14: 58.4%
## Power at a sample size of 15: 57%
## Power at a sample size of 16: 59.8%
## Power at a sample size of 17: 58.4%
## Power at a sample size of 18: 63%
## Power at a sample size of 19: 63.2%
## Power at a sample size of 20: 65.8%
## Power at a sample size of 21: 66.6%
## Power at a sample size of 22: 69.4%
## Power at a sample size of 23: 76%
## Power at a sample size of 24: 74.4%
## Power at a sample size of 25: 73%
## Power at a sample size of 26: 75.4%
## Power at a sample size of 27: 78.8%
## Power at a sample size of 28: 79.4%
## Power at a sample size of 29: 79.8%
## Power at a sample size of 30: 80.2%
## Sample size needed:  30 
## Note: This is number of subjects *per group* i.e. 30 from the control group and 30 from the test group. It should be considered a lower bound at best! Please consult Amy with any questions.</code></pre>
<p>Wooohooo! 30 bloom and 30 non-bloom samples are needed. <em>As an estimate!</em></p>
</div>
<div id="coming-soon" class="section level2">
<h2 class="hasAnchor">
<a href="#coming-soon" class="anchor"></a>Coming soon…</h2>
<p>Is almost certainly possible to find a closed form expression for this. What is implemented here is a really, really primitive way of doing it. I will come back to the math approach ASAP. (Sorry, I have a thesis to write!)</p>
</div>
<div id="how-to-pick-your-standard-error" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-pick-your-standard-error" class="anchor"></a>How to pick your standard error</h2>
<p>Good question! Vignette coming soon… (Write to me to tell me to hurry up if you need it! Is anyone actually reading this?)</p>
</div>
<div id="more-complex-experimental-designs" class="section level2">
<h2 class="hasAnchor">
<a href="#more-complex-experimental-designs" class="anchor"></a>More complex experimental designs…</h2>
<p>Oooooo I love this question! Feel free to modify the code to match your experiment design. If you don’t know how to do this or think that your design is broadly relevant, send me an email and I will implement it. (Free of charge!)</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#loading-the-package-and-your-data">Loading the package and your data</a></li>
      <li><a href="#coming-soon">Coming soon…</a></li>
      <li><a href="#how-to-pick-your-standard-error">How to pick your standard error</a></li>
      <li><a href="#more-complex-experimental-designs">More complex experimental designs…</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Amy Willis, Kathryn Barger, John Bunge.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
