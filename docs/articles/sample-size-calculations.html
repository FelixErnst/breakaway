<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sample size calculations for alpha diversity • breakaway</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Sample size calculations for alpha diversity">
<meta property="og:description" content="breakaway">
<meta property="og:image" content="http://adw96.github.io/breakaway/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">breakaway</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">4.7.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/breakaway.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/diversity-hypothesis-testing.html">Introduction to hypothesis testing for diversity</a>
    </li>
    <li>
      <a href="../articles/extended-tutorial.html">Getting into the weeds</a>
    </li>
    <li>
      <a href="../articles/intro-diversity-estimation.html">Introduction to diversity estimation</a>
    </li>
    <li>
      <a href="../articles/sample-size-calculations.html">Sample size calculations for alpha diversity</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/adw96/breakaway/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="sample-size-calculations_files/header-attrs-2.2/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Sample size calculations for alpha diversity</h1>
                        <h4 class="author">Amy Willis</h4>
            
            <h4 class="date">2020-07-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/adw96/breakaway/blob/master/vignettes/sample-size-calculations.Rmd"><code>vignettes/sample-size-calculations.Rmd</code></a></small>
      <div class="hidden name"><code>sample-size-calculations.Rmd</code></div>

    </div>

    
    
<p>This is a really quick introduction to using the sample size calculation tools provided in <code>breakaway</code>. It assumes reasonable familiarity with both <code>R</code> and <code>breakaway</code>.</p>
<div id="loading-the-package-and-your-data" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-the-package-and-your-data" class="anchor"></a>Loading the package and your data</h2>
<p>Download the latest version of the package from github.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co">### Run the first two lines at home! ####</span>
<span class="co"># install.packages("devtools")</span>
<span class="co"># devtools::install_github("adw96/breakaway")</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">breakaway</span>)</pre></body></html></div>
<p>Let’s consider some example OTU tables, taxonomy information, and covariate information.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r">#my_table &lt;- data(toy_otu_table)
#my_taxonomy &lt;- data(toy_taxonomy)
#meta &lt;- data(toy_metadata)</pre></body></html></div>
<p>Suppose we are interested in the species richness of cyanobacteria, and whether or not it changes with a cyanobacteria bloom event. (You could easily generalise this to toxin-forming genera, if that was your target of interest (Amy to <span class="citation">@Sarah</span>)…)</p>
<p>The data is probably noisy and so we may not have a strong enough signal to detect a difference in richness with bloom. The point of these tools is to help you find an <em>estimate</em> of how many samples you might need to detect such a difference.</p>
<p>First set up the species richness and bloom variables.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co">## Find how many otus are in the cyanobacteria genus</span>
<span class="no">cyano_nodes</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">toy_otu_table</span>[<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Cyano"</span>, <span class="no">toy_taxonomy</span>), ], <span class="fl">2</span>, <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">x</span><span class="kw">&gt;</span><span class="fl">0</span>))
<span class="no">cyano_nodes</span> <span class="kw">&lt;-</span> <span class="no">cyano_nodes</span>

<span class="no">bloom1</span> <span class="kw">&lt;-</span> <span class="no">toy_metadata</span>[, <span class="st">"bloom2"</span>]
<span class="no">bloom</span> <span class="kw">&lt;-</span> <span class="no">bloom1</span> <span class="kw">==</span> <span class="st">"yes"</span></pre></body></html></div>
<p>Let’s start by drawing a picture. Could a difference even be possible?</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">bloom</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">cyano_nodes</span>[<span class="no">bloom</span>], <span class="no">cyano_nodes</span>[!<span class="no">bloom</span>]),
     <span class="kw">pch</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">16</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">bloom</span>)), <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(!<span class="no">bloom</span>)))) <span class="co">## Hmmm ambiguous</span></pre></body></html></div>
<p><img src="sample-size-calculations_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>Fascinating! We observe much more low richnesses for non-bloom samples, but it’s really quite ambiguous.</p>
<p>An important consideration is that our samples are not exhaustive: each of these cyanobacteria richness values are estimated and not, in fact, correct. There almost certainly were more phyla present than we observed. Estimating the total phyla richness is a great problem for <code>breakaway</code>. Actually, it’s probably better for CatchAll, because there’s not that much richness (only around 20 phyla per sample). Let’s come back to estimating the total phyla richness another time and focus instead on finding the required sample size to detect a difference when there is noise.</p>
<p>I’m going to make a big leap now and pretend that I know that the standard deviation in the bloom richnesses is 2, and the standard deviation in non-bloom richnesses is 5. How would the above picture change? Sounds like a good problem for <code>betta_pic</code></p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="../reference/betta_pic.html">betta_pic</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">cyano_nodes</span>[<span class="no">bloom</span>], <span class="no">cyano_nodes</span>[!<span class="no">bloom</span>]), <span class="kw">se</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">bloom</span>)), <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(!<span class="no">bloom</span>))), <span class="kw">mypch</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">16</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">bloom</span>)), <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(!<span class="no">bloom</span>))))</pre></body></html></div>
<p><img src="sample-size-calculations_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Ooooo, difficult! With this picture suggest a difference? Maybe. We definitely need more samples. I wonder how many? (That’s the point of this tutorial, FYI)</p>
<p>Why would the standard deviation change the necessary sample size? Let’s suppose that both groups have the same standard error. How do the differences between the groups change?</p>
<pre><code>##       Estimates Standard Errors p-values
##            19.1       0.7657131        0
## bloom       7.9       1.5939589        0</code></pre>
<pre><code>##       Estimates Standard Errors p-values
##            19.1        1.672484    0.000
## bloom       7.9        3.481553    0.023</code></pre>
<pre><code>##       Estimates Standard Errors p-values
##            19.1        2.926847    0.000
## bloom       7.9        6.092718    0.195</code></pre>
<p>So larger standard errors lead to less precise estimates. Note that the estimate of the difference (in phyla richnesses) between the groups doesn’t change, but its standard error does, which changes the p-value.</p>
<p>Okay, let’s start by estimating the standard errors as the within group standard deviations.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">cyano_nodes</span>[<span class="no">bloom</span>])</pre></body></html></div>
<pre><code>## [1] 6.919176</code></pre>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">cyano_nodes</span>[!<span class="no">bloom</span>])</pre></body></html></div>
<pre><code>## [1] 9.716108</code></pre>
<p>This is kind of primitive but not that bad to start.</p>
<p>I’d prefer to be conservative and choose a larger standard error… the maximum of both groups would suit me fine. So for my simulation I’m going to choose a standard error of 10, common to both groups. So I set <code>se_est = 10</code>.</p>
<p>Suppose that 6 more phyla is concerning, that is, a difference 6 in the of species richness is the difference I want to detect. So I set <code>diff = 6</code>.</p>
<p>For no good reason, suppose I want to test at the 5% level. <code>alpha = 0.05</code>.</p>
<p>Power of 80%? Why not?! <code>prop = 0.8</code> TODO: Amy to rename this to <code>power</code></p>
<p>I’ve got time to go make myself a coffee, and I care a lot about precision, so I will set <code>samples = 500</code>. Only have time for a sneeze? Set <code>samples = 100</code>. Big boozy lunch? <code>samples = 2000</code>. Scales linearly. It’s pretty fast! (No thanks to me…)</p>
<pre><code>## Warning in sqrt(.): NaNs produced</code></pre>
<pre><code>## Power at a sample size of 5: 30.4%</code></pre>
<pre><code>## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced</code></pre>
<pre><code>## Power at a sample size of 6: 35.8%</code></pre>
<pre><code>## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced</code></pre>
<pre><code>## Power at a sample size of 7: 40%</code></pre>
<pre><code>## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced</code></pre>
<pre><code>## Power at a sample size of 8: 40.6%</code></pre>
<pre><code>## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced</code></pre>
<pre><code>## Power at a sample size of 9: 42.8%</code></pre>
<pre><code>## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced</code></pre>
<pre><code>## Power at a sample size of 10: 47.4%</code></pre>
<pre><code>## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced</code></pre>
<pre><code>## Power at a sample size of 11: 44%</code></pre>
<pre><code>## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced</code></pre>
<pre><code>## Power at a sample size of 12: 55.4%</code></pre>
<pre><code>## Warning in sqrt(.): NaNs produced</code></pre>
<pre><code>## Power at a sample size of 13: 53.8%</code></pre>
<pre><code>## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced</code></pre>
<pre><code>## Power at a sample size of 14: 56.2%</code></pre>
<pre><code>## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced</code></pre>
<pre><code>## Power at a sample size of 15: 57.2%</code></pre>
<pre><code>## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced</code></pre>
<pre><code>## Power at a sample size of 16: 64.8%</code></pre>
<pre><code>## Warning in sqrt(.): NaNs produced</code></pre>
<pre><code>## Power at a sample size of 17: 58.6%</code></pre>
<pre><code>## Power at a sample size of 18: 63.6%</code></pre>
<pre><code>## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced</code></pre>
<pre><code>## Power at a sample size of 19: 70.2%</code></pre>
<pre><code>## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced</code></pre>
<pre><code>## Power at a sample size of 20: 64.6%</code></pre>
<pre><code>## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced</code></pre>
<pre><code>## Power at a sample size of 21: 71.2%</code></pre>
<pre><code>## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced</code></pre>
<pre><code>## Power at a sample size of 22: 71.2%</code></pre>
<pre><code>## Power at a sample size of 23: 72%</code></pre>
<pre><code>## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced</code></pre>
<pre><code>## Power at a sample size of 24: 75.2%</code></pre>
<pre><code>## Power at a sample size of 25: 74.4%</code></pre>
<pre><code>## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced</code></pre>
<pre><code>## Power at a sample size of 26: 76.8%</code></pre>
<pre><code>## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced</code></pre>
<pre><code>## Power at a sample size of 27: 76.4%</code></pre>
<pre><code>## Warning in sqrt(.): NaNs produced

## Warning in sqrt(.): NaNs produced</code></pre>
<pre><code>## Power at a sample size of 28: 81.4%</code></pre>
<pre><code>## Sample size needed:  28</code></pre>
<pre><code>## Note: This is number of subjects *per group* i.e. 28 from the control group and 28 from the test group. It should be considered a lower bound at best! Please consult Amy with any questions.</code></pre>
<p>Wooohooo! 30 bloom and 30 non-bloom samples are needed. <em>As an estimate!</em></p>
</div>
<div id="coming-soon" class="section level2">
<h2 class="hasAnchor">
<a href="#coming-soon" class="anchor"></a>Coming soon…</h2>
<p>Is almost certainly possible to find a closed form expression for this. What is implemented here is a really, really primitive way of doing it. I will come back to the math approach ASAP. (Sorry, I have a thesis to write!)</p>
</div>
<div id="how-to-pick-your-standard-error" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-pick-your-standard-error" class="anchor"></a>How to pick your standard error</h2>
<p>Good question! Vignette coming soon… (Write to me to tell me to hurry up if you need it! Is anyone actually reading this?)</p>
</div>
<div id="more-complex-experimental-designs" class="section level2">
<h2 class="hasAnchor">
<a href="#more-complex-experimental-designs" class="anchor"></a>More complex experimental designs…</h2>
<p>Oooooo I love this question! Feel free to modify the code to match your experiment design. If you don’t know how to do this or think that your design is broadly relevant, send me an email and I will implement it. (Free of charge!)</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Amy Willis, Bryan D Martin, Pauline Trinh, Kathryn Barger, John Bunge.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
