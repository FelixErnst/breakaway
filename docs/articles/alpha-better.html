<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>alpha diversity, properly • breakaway</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">breakaway</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/breakaway.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/alpha-better.html">alpha diversity, properly</a>
    </li>
    <li>
      <a href="../articles/betta-figure.html">Comparing samples visually with betta</a>
    </li>
    <li>
      <a href="../articles/resample-estimates.html">Variance of alpha diversity estimates</a>
    </li>
    <li>
      <a href="../articles/sample-size-calculations.html">Sample size calculations for alpha diversity</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>alpha diversity, properly</h1>
                        <h4 class="author">Amy Willis</h4>
            
            <h4 class="date">2017-10-04</h4>
          </div>

    
    
<div class="contents">
<p>An unfinished tutorial to demonstrate <code>shannon_better</code> and other alpha diversity estimates that adjust for missing taxa!</p>
<p>TODO: Finish this!</p>
<p>Let’s start by writing some functions to invent fake communities. This is so we can validate the idea on fake data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(breakaway)
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(gridExtra)
<span class="kw">library</span>(dplyr)</code></pre></div>
<pre><code>## 
## Attaching package: 'dplyr'</code></pre>
<pre><code>## The following object is masked from 'package:gridExtra':
## 
##     combine</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(magrittr)
<span class="kw">library</span>(grid)
<span class="kw">library</span>(lattice)


<span class="co"># create a total community</span>
make_community2 &lt;-<span class="st"> </span>function(CC, <span class="dt">alpha_parameter =</span> <span class="dv">1</span>, <span class="dt">beta_parameter =</span> <span class="dv">2</span>) {
  relative_proportions &lt;-<span class="st"> </span><span class="kw">rbeta</span>(CC, alpha_parameter, beta_parameter) <span class="co"># this is just a good way to get relative abundances</span>
  raw_abundances &lt;-<span class="st"> </span>relative_proportions/<span class="kw">sum</span>(relative_proportions)
  output &lt;-<span class="st"> </span><span class="kw">list</span>()
  output$proportions &lt;-<span class="st"> </span>raw_abundances
  output
}

<span class="co"># let's simulate some rarefaction curves</span>
subsample_community &lt;-<span class="st"> </span>function(population, n) {
  output &lt;-<span class="st"> </span><span class="kw">list</span>()
  who &lt;-<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/sample.html">sample</a></span>(population$names, n, <span class="dt">replace =</span> F)
  community &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">as.matrix</span>(<span class="kw">table</span>(who)))
  abundances &lt;-<span class="st"> </span>community/<span class="kw">sum</span>(community)
  output$names &lt;-<span class="st"> </span>who
  output$proportions &lt;-<span class="st"> </span>abundances
  output
}

draw_rarefaction &lt;-<span class="st"> </span>function(population, <span class="dt">pts =</span> <span class="ot">NA</span>, <span class="dt">replicates =</span> <span class="dv">5</span>, <span class="dt">ecosystem =</span> <span class="ot">NA</span>) {
  rarefaction_table &lt;-<span class="st"> </span><span class="kw">data.frame</span>()
  if (<span class="kw">all</span>(<span class="kw">is.na</span>(pts))) pts &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">round</span>(<span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">5</span>, <span class="dt">to =</span> <span class="kw">length</span>(population$names)/<span class="dv">100</span>, <span class="dt">length =</span> <span class="dv">100</span>)),
                                <span class="kw">round</span>(<span class="kw">seq</span>(<span class="dt">from =</span> <span class="kw">length</span>(population$names)/<span class="dv">100</span>, <span class="dt">to =</span> <span class="kw">length</span>(population$names)/<span class="dv">10</span>, <span class="dt">length =</span> <span class="dv">100</span>)),
                                <span class="kw">round</span>(<span class="kw">seq</span>(<span class="dt">from =</span> <span class="kw">length</span>(population$names)/<span class="dv">10</span>, <span class="dt">to =</span> <span class="kw">length</span>(population$names)/<span class="dv">4</span>, <span class="dt">length =</span> <span class="dv">100</span>)),
                                <span class="kw">round</span>(<span class="kw">seq</span>(<span class="dt">from =</span> <span class="kw">length</span>(population$names)/<span class="dv">4</span>, <span class="dt">to =</span> <span class="kw">length</span>(population$names), <span class="dt">length =</span> <span class="dv">10</span>)))
  who &lt;-<span class="st"> </span><span class="kw">replicate</span>(replicates, <span class="kw"><a href="http://dplyr.tidyverse.org/reference/sample.html">sample</a></span>(population$names, <span class="kw">length</span>(population$names), <span class="dt">replace =</span> F))
  for (i in pts) {
    subsample_diversity &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, replicates)
    subsample_shannon &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, replicates)
    for (j in <span class="dv">1</span>:replicates) {  
      subsample &lt;-<span class="st"> </span>who[<span class="dv">1</span>:i, j]
      subsample_diversity[j] &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(subsample))
      community &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">as.matrix</span>(<span class="kw">table</span>(subsample)))
      proportions &lt;-<span class="st"> </span>community/<span class="kw">sum</span>(community)
      subsample_shannon[j] &lt;-<span class="st"> </span>breakaway::<span class="kw"><a href="../reference/shannon.html">shannon</a></span>(proportions)
    }
    rarefaction_table %&lt;&gt;%<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">data.frame</span>(<span class="st">"reads"</span> =<span class="st"> </span>i, 
                                            <span class="st">"richness"</span> =<span class="st"> </span><span class="kw">min</span>(subsample_diversity), <span class="st">"richness_max"</span> =<span class="st"> </span><span class="kw">max</span>(subsample_diversity), 
                                            <span class="st">"shannon"</span> =<span class="st"> </span><span class="kw">min</span>(subsample_shannon), <span class="st">"shannon_max"</span> =<span class="st"> </span><span class="kw">max</span>(subsample_shannon), 
                                            <span class="st">"ecosystem"</span> =<span class="st"> </span>ecosystem, <span class="st">"type"</span> =<span class="st"> "rcurve"</span>))
  }
  rarefaction_table
}

get_point &lt;-<span class="st"> </span>function(ecosystem, read, label) {
  read &lt;-<span class="st"> </span><span class="kw">round</span>(read)
  my_population &lt;-<span class="st"> </span><span class="kw">get</span>(<span class="kw">paste</span>(<span class="st">"population"</span>, ecosystem, <span class="dt">sep=</span><span class="st">""</span>))
  ecosystem_name &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">"ecosystem"</span>, ecosystem, <span class="dt">sep=</span><span class="st">""</span>)
  subsample &lt;-<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/sample.html">sample</a></span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">1</span>:<span class="kw">length</span>(my_population$proportions)), <span class="dt">size =</span> read, <span class="dt">prob =</span> my_population$proportions, <span class="dt">replace =</span> T)
  
  point &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="st">"reads"</span> =<span class="st"> </span>read, 
                      <span class="st">"richness"</span> =<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(subsample)), <span class="st">"richness_max"</span> =<span class="st"> </span><span class="ot">NA</span>,
                      <span class="st">"shannon"</span> =<span class="st"> </span>breakaway::<span class="kw"><a href="../reference/shannon.html">shannon</a></span>(<span class="kw">c</span>(<span class="kw">as.matrix</span>(<span class="kw">table</span>(subsample)))/<span class="kw">sum</span>(<span class="kw">c</span>(<span class="kw">as.matrix</span>(<span class="kw">table</span>(subsample))))), 
                      <span class="st">"shannon_max"</span> =<span class="st"> </span><span class="ot">NA</span>, 
                      <span class="st">"ecosystem"</span> =<span class="st"> </span>ecosystem_name, <span class="st">"type"</span> =<span class="st"> "observation"</span>)
  subsample1 &lt;-<span class="st"> </span><span class="kw">list</span>()
  subsample1$names &lt;-<span class="st"> </span>subsample
  subsample1$proportions &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">as.matrix</span>(<span class="kw">table</span>(subsample)))/<span class="kw">sum</span>(<span class="kw">c</span>(<span class="kw">as.matrix</span>(<span class="kw">table</span>(subsample))))
  rarefied_sample &lt;-<span class="st"> </span><span class="kw">draw_rarefaction</span>(subsample1, <span class="dt">replicates =</span> <span class="dv">1</span>, <span class="dt">pts =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">1</span>, <span class="dt">to =</span> read, <span class="dt">length =</span> <span class="dv">100</span>), 
                                      <span class="dt">ecosystem =</span> ecosystem_name)
  rarefied_sample$type &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">"rarefied_sample"</span>, label, <span class="dt">sep=</span><span class="st">""</span>)
  
  richness_estimate &lt;-<span class="st"> </span>subsample %&gt;%<span class="st"> </span>make_frequency_count_table %&gt;%<span class="st"> </span><span class="kw"><a href="../reference/breakaway.html">breakaway</a></span>(<span class="dt">print =</span> F, <span class="dt">answers =</span> T, <span class="dt">plot =</span> F) %$%<span class="st"> </span>ci 
  
  shannon_estimate &lt;-<span class="st"> </span>subsample %&gt;%<span class="st"> </span>make_frequency_count_table  %&gt;%<span class="st"> </span>shannon_better
  
  <span class="kw">names</span>(shannon_estimate)[<span class="dv">3</span>:<span class="dv">4</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"shannon"</span>, <span class="st">"shannon_max"</span>)
  <span class="kw">print</span>(shannon_estimate)
  estimate &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="st">"reads"</span> =<span class="st"> </span>read, 
                         <span class="st">"richness"</span> =<span class="st"> </span>richness_estimate[<span class="dv">1</span>], <span class="st">"richness_max"</span> =<span class="st"> </span>richness_estimate[<span class="dv">2</span>],
                         <span class="st">"shannon"</span> =<span class="st"> </span>shannon_estimate[<span class="dv">3</span>], <span class="st">"shannon_max"</span> =<span class="st"> </span>shannon_estimate[<span class="dv">4</span>],
                         <span class="st">"ecosystem"</span> =<span class="st"> </span>ecosystem_name, <span class="st">"type"</span> =<span class="st"> </span><span class="kw">paste</span>(<span class="st">"estimate"</span>, label, <span class="dt">sep=</span><span class="st">""</span>))
  
  <span class="kw">rbind</span>(point, rarefied_sample, estimate)
}
get_truth &lt;-<span class="st"> </span>function(ecosystem_number) {
  ecosystem &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">"population"</span>, ecosystem_number, <span class="dt">sep =</span> <span class="st">""</span>)
  population &lt;-<span class="st"> </span><span class="kw">get</span>(ecosystem)
  <span class="kw">data.frame</span>(<span class="st">"reads"</span> =<span class="st"> </span><span class="dv">0</span>, <span class="st">"richness"</span> =<span class="st"> </span><span class="kw">length</span>(population$proportions), <span class="st">"richness_max"</span> =<span class="st"> </span><span class="ot">NA</span>,
             <span class="st">"shannon"</span> =<span class="st"> </span>breakaway::<span class="kw"><a href="../reference/shannon.html">shannon</a></span>(population$proportions), <span class="st">"shannon_max"</span> =<span class="st"> </span><span class="ot">NA</span>, 
             <span class="st">"ecosystem"</span> =<span class="st">  </span><span class="kw">paste</span>(<span class="st">"ecosystem"</span>, ecosystem_number, <span class="dt">sep =</span> <span class="st">""</span>), <span class="st">"type"</span> =<span class="st"> "truth"</span>)
}</code></pre></div>
<p>Now let’s actually create some communities, and draw some pretend samples from them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">170918</span>)

Ca =<span class="st"> </span><span class="dv">6000</span>
Cb =<span class="st"> </span><span class="dv">5000</span>
aa =<span class="st"> </span><span class="fl">0.5</span>
ab =<span class="st"> </span>aa
ba =<span class="st"> </span><span class="dv">3</span>
bb =<span class="st"> </span><span class="dv">1</span>

<span class="co"># rarefaction curves</span>
population1 &lt;-<span class="st"> </span><span class="kw">make_community2</span>(Ca, <span class="dt">alpha_parameter =</span> aa, <span class="dt">beta_parameter =</span> ab)
population2 &lt;-<span class="st"> </span><span class="kw">make_community2</span>(Cb, <span class="dt">alpha_parameter =</span> ba, <span class="dt">beta_parameter =</span> bb)

<span class="co"># observations and truth</span>
truth &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">get_truth</span>(<span class="dv">1</span>), <span class="kw">get_truth</span>(<span class="dv">2</span>))

observations &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">get_point</span>(<span class="dv">2</span>, <span class="dv">25000</span>, <span class="dv">1</span>), 
                      <span class="kw">get_point</span>(<span class="dv">2</span>, <span class="dv">12000</span>, <span class="dv">2</span>),
                      <span class="kw">get_point</span>(<span class="dv">2</span>, <span class="dv">8000</span>, <span class="dv">3</span>), 
                      <span class="kw">get_point</span>(<span class="dv">2</span>, <span class="dv">7000</span>, <span class="dv">4</span>),
                      <span class="kw">get_point</span>(<span class="dv">2</span>, <span class="dv">16000</span>, <span class="dv">5</span>),
                      <span class="kw">get_point</span>(<span class="dv">1</span>, <span class="dv">8000</span>, <span class="dv">1</span>),
                      <span class="kw">get_point</span>(<span class="dv">1</span>, <span class="dv">14000</span>, <span class="dv">2</span>),
                      <span class="kw">get_point</span>(<span class="dv">1</span>, <span class="dv">5000</span>, <span class="dv">3</span>),
                      <span class="kw">get_point</span>(<span class="dv">1</span>, <span class="dv">7500</span>, <span class="dv">4</span>),
                      <span class="kw">get_point</span>(<span class="dv">1</span>, <span class="dv">4500</span>, <span class="dv">5</span>),
                      <span class="kw">get_point</span>(<span class="dv">1</span>, <span class="dv">3000</span>, <span class="dv">6</span>))</code></pre></div>
<pre><code>## Warning in shannon_better(.): Confidence intervals and standard errors are
## approximate!</code></pre>
<pre><code>##     index estimate    shannon shannon_max    upper
## 1 shannon 8.394009 0.04684391    8.302197 8.485822</code></pre>
<pre><code>## Warning in shannon_better(.): Confidence intervals and standard errors are
## approximate!</code></pre>
<pre><code>##     index estimate    shannon shannon_max    upper
## 1 shannon 8.371503 0.06743262    8.239337 8.503668</code></pre>
<pre><code>## Warning in shannon_better(.): Confidence intervals and standard errors are
## approximate!</code></pre>
<pre><code>##     index estimate    shannon shannon_max    upper
## 1 shannon 8.380738 0.08267669    8.218695 8.542782</code></pre>
<pre><code>## Warning in shannon_better(.): Confidence intervals and standard errors are
## approximate!</code></pre>
<pre><code>##     index estimate   shannon shannon_max    upper
## 1 shannon 8.396488 0.0885631    8.222908 8.570069</code></pre>
<pre><code>## Warning in shannon_better(.): Confidence intervals and standard errors are
## approximate!</code></pre>
<pre><code>##     index estimate    shannon shannon_max    upper
## 1 shannon 8.374706 0.05842253      8.2602 8.489212</code></pre>
<pre><code>## Warning in shannon_better(.): Confidence intervals and standard errors are
## approximate!</code></pre>
<pre><code>##     index estimate  shannon shannon_max    upper
## 1 shannon 8.334576 0.082179    8.173508 8.495644</code></pre>
<pre><code>## Warning in shannon_better(.): Confidence intervals and standard errors are
## approximate!</code></pre>
<pre><code>##     index estimate    shannon shannon_max    upper
## 1 shannon 8.452712 0.06313501    8.328969 8.576454</code></pre>
<pre><code>## Warning in shannon_better(.): Confidence intervals and standard errors are
## approximate!</code></pre>
<pre><code>##     index estimate   shannon shannon_max    upper
## 1 shannon 8.451211 0.1055248    8.244386 8.658036</code></pre>
<pre><code>## Warning in shannon_better(.): Confidence intervals and standard errors are
## approximate!</code></pre>
<pre><code>##     index estimate    shannon shannon_max    upper
## 1 shannon 8.376672 0.08535505     8.20938 8.543965</code></pre>
<pre><code>## Warning in shannon_better(.): Confidence intervals and standard errors are
## approximate!</code></pre>
<pre><code>##     index estimate   shannon shannon_max    upper
## 1 shannon 8.301616 0.1090084    8.087963 8.515269</code></pre>
<pre><code>## Warning in shannon_better(.): Confidence intervals and standard errors are
## approximate!</code></pre>
<pre><code>##     index estimate   shannon shannon_max    upper
## 1 shannon 8.370372 0.1346813    8.106401 8.634342</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rarefaction_level &lt;-<span class="st"> </span>observations %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(type ==<span class="st"> "observation"</span>) %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(reads) %&gt;%<span class="st"> </span>min

rarefaction_table &lt;-<span class="st"> </span><span class="kw">rbind</span>(observations, truth)
rarefaction_table %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(ecosystem) %&gt;%<span class="st"> </span>unlist %&gt;%<span class="st"> </span><span class="kw">substring</span>(<span class="dv">10</span>, <span class="dv">11</span>) %&gt;%<span class="st"> </span>as.numeric -&gt;<span class="st"> </span>rarefaction_table$ecosystem_number


plot_base &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="dt">data =</span> rarefaction_table, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">col =</span> ecosystem)) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>() 

plot_5_a &lt;-<span class="st"> </span>plot_base +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">labs</a></span>(<span class="dt">x=</span><span class="st">"No. reads"</span>, <span class="dt">y=</span><span class="st">"Taxonomic richness"</span>,<span class="dt">col =</span> <span class="st">""</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/coord_cartesian">coord_cartesian</a></span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">26000</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">7000</span>)) +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>(<span class="dt">data =</span> rarefaction_table %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(type ==<span class="st"> "observation"</span>), 
             <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>reads, <span class="dt">y=</span>richness, <span class="dt">col =</span> ecosystem))+
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/theme">theme</a></span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="fl">0.7</span>, <span class="fl">0.25</span>), <span class="dt">legend.text=</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/element">element_text</a></span>(<span class="dt">size=</span><span class="dv">7</span>))  +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_hue">scale_color_discrete</a></span>(<span class="dt">name=</span><span class="st">""</span>,
                       <span class="dt">breaks=</span><span class="kw">c</span>(<span class="st">"ecosystem1"</span>, <span class="st">"ecosystem2"</span>), 
                       <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">"Environment A"</span>, <span class="st">"Environment B"</span>)) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/guides">guides</a></span>(<span class="dt">fill=</span><span class="ot">FALSE</span>)
plot_5_b &lt;-<span class="st"> </span>plot_base +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">labs</a></span>(<span class="dt">x=</span><span class="st">"No. reads"</span>, <span class="dt">y=</span><span class="st">"Shannon diversity"</span>,<span class="dt">col =</span> <span class="st">""</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/coord_cartesian">coord_cartesian</a></span>(<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">26000</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">9</span>)) +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>(<span class="dt">data =</span> rarefaction_table %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(type ==<span class="st"> "observation"</span>), 
             <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>reads, <span class="dt">y=</span>shannon, <span class="dt">col =</span> ecosystem))+
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/theme">theme</a></span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="fl">0.7</span>, <span class="fl">0.3</span>), <span class="dt">legend.text=</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/element">element_text</a></span>(<span class="dt">size=</span><span class="dv">7</span>))  +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_hue">scale_color_discrete</a></span>(<span class="dt">name=</span><span class="st">""</span>,
                       <span class="dt">breaks=</span><span class="kw">c</span>(<span class="st">"ecosystem1"</span>, <span class="st">"ecosystem2"</span>), 
                       <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">"Environment A"</span>, <span class="st">"Environment B"</span>)) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/guides">guides</a></span>(<span class="dt">fill=</span><span class="ot">FALSE</span>)

plot_6_a &lt;-<span class="st"> </span>plot_5_a +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_ribbon">geom_ribbon</a></span>(<span class="dt">data =</span> rarefaction_table %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(type ==<span class="st"> "rcurve"</span>),
              <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>reads, <span class="dt">ymin=</span>richness, <span class="dt">ymax=</span>richness_max, <span class="dt">col =</span> ecosystem, <span class="dt">fill =</span> ecosystem), <span class="dt">alpha =</span> <span class="dv">0</span>, <span class="dt">linetype =</span> <span class="dv">0</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>(<span class="dt">data =</span> rarefaction_table %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(type ==<span class="st"> "observation"</span>),
           <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>reads, <span class="dt">y=</span>richness, <span class="dt">col =</span> ecosystem))+
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>(<span class="dt">data =</span> rarefaction_table %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(type ==<span class="st"> "rarefied_sample1"</span>),
            <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>reads, <span class="dt">y=</span>richness, <span class="dt">col =</span> ecosystem)) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"Rarefaction curve"</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>(<span class="dt">data =</span> rarefaction_table %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(type ==<span class="st"> "rarefied_sample2"</span>),
            <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>reads, <span class="dt">y=</span>richness, <span class="dt">col =</span> ecosystem)) 
  
plot_6_d &lt;-<span class="st"> </span>plot_5_b +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_ribbon">geom_ribbon</a></span>(<span class="dt">data =</span> rarefaction_table %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(type ==<span class="st"> "rcurve"</span>),
              <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>reads, <span class="dt">ymin=</span>shannon, <span class="dt">ymax=</span>shannon_max, <span class="dt">col =</span> ecosystem, <span class="dt">fill =</span> ecosystem), <span class="dt">alpha =</span> <span class="dv">0</span>, <span class="dt">linetype =</span> <span class="dv">0</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>(<span class="dt">data =</span> rarefaction_table %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(type ==<span class="st"> "observation"</span>),
             <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>reads, <span class="dt">y=</span>shannon, <span class="dt">col =</span> ecosystem))+
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>(<span class="dt">data =</span> rarefaction_table %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(type ==<span class="st"> "rarefied_sample1"</span>),
            <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>reads, <span class="dt">y=</span>shannon, <span class="dt">col =</span> ecosystem)) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>(<span class="dt">data =</span> rarefaction_table %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(type ==<span class="st"> "rarefied_sample2"</span>),
            <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>reads, <span class="dt">y=</span>shannon, <span class="dt">col =</span> ecosystem)) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"Rarefaction curve"</span>)


plot_7a_left &lt;-<span class="st"> </span>plot_6_a +<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_abline">geom_hline</a></span>(<span class="dt">data =</span> rarefaction_table %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(type ==<span class="st"> "truth"</span>), 
             <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">yintercept=</span>richness, <span class="dt">col =</span> ecosystem), <span class="dt">lty =</span> <span class="dv">2</span>) 

plot_7b_left &lt;-<span class="st"> </span>plot_6_d +<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_abline">geom_hline</a></span>(<span class="dt">data =</span> rarefaction_table %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(type ==<span class="st"> "truth"</span>), 
             <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">yintercept=</span>shannon, <span class="dt">col =</span> ecosystem), <span class="dt">lty =</span> <span class="dv">2</span>) 

plot_7_a &lt;-<span class="st"> </span>plot_base +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_continuous">scale_x_continuous</a></span>(<span class="dt">name=</span><span class="st">"Environment"</span>, <span class="dt">breaks=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">2.5</span>)) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>(<span class="dt">data =</span> rarefaction_table %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(type ==<span class="st"> "observation"</span>), 
             <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>ecosystem_number +<span class="st"> </span><span class="kw">c</span>(<span class="kw">seq</span>(-<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dt">length.out =</span> <span class="dv">6</span>), 
                                        <span class="kw">seq</span>(-<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dt">length.out =</span> <span class="dv">5</span>)), <span class="dt">y=</span>richness, <span class="dt">col =</span> ecosystem), <span class="dt">alpha =</span> <span class="fl">0.1</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_linerange">geom_linerange</a></span>(<span class="dt">data =</span> rarefaction_table %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">substr</span>(type, <span class="dv">1</span>, <span class="dv">8</span>) ==<span class="st"> "estimate"</span>), 
                 <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> ecosystem_number +<span class="st"> </span><span class="kw">c</span>(<span class="kw">seq</span>(-<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dt">length.out =</span> <span class="dv">6</span>), 
                                              <span class="kw">seq</span>(-<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dt">length.out =</span> <span class="dv">5</span>)), <span class="dt">ymin=</span>richness, <span class="dt">ymax =</span> richness_max), <span class="dt">lty =</span> <span class="dv">1</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_abline">geom_hline</a></span>(<span class="dt">data =</span> rarefaction_table %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(type ==<span class="st"> "truth"</span>), 
             <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">yintercept=</span>richness, <span class="dt">col =</span> ecosystem), <span class="dt">lty =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">labs</a></span>(<span class="dt">y=</span><span class="st">"Taxonomic richness"</span>,<span class="dt">col =</span> <span class="st">""</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/theme">theme</a></span>(<span class="dt">legend.position=</span><span class="st">"none"</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"Estimated true richness with error"</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/coord_cartesian">coord_cartesian</a></span>(<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">7000</span>))

plot_7_b &lt;-<span class="st"> </span>plot_base +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_continuous">scale_x_continuous</a></span>(<span class="dt">name=</span><span class="st">"Environment"</span>, <span class="dt">breaks=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">2.5</span>)) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>(<span class="dt">data =</span> rarefaction_table %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(type ==<span class="st"> "observation"</span>), 
             <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>ecosystem_number +<span class="st"> </span><span class="kw">c</span>(<span class="kw">seq</span>(-<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dt">length.out =</span> <span class="dv">6</span>), 
                                        <span class="kw">seq</span>(-<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dt">length.out =</span> <span class="dv">5</span>)), <span class="dt">y=</span>shannon, <span class="dt">col =</span> ecosystem), <span class="dt">alpha =</span> <span class="fl">0.1</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_linerange">geom_linerange</a></span>(<span class="dt">data =</span> rarefaction_table %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">substr</span>(type, <span class="dv">1</span>, <span class="dv">8</span>) ==<span class="st"> "estimate"</span>), 
                 <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> ecosystem_number +<span class="st"> </span><span class="kw">c</span>(<span class="kw">seq</span>(-<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dt">length.out =</span> <span class="dv">6</span>), 
                                              <span class="kw">seq</span>(-<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dt">length.out =</span> <span class="dv">5</span>)), <span class="dt">ymin=</span>shannon, <span class="dt">ymax =</span> shannon_max), <span class="dt">lty =</span> <span class="dv">1</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_abline">geom_hline</a></span>(<span class="dt">data =</span> rarefaction_table %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(type ==<span class="st"> "truth"</span>), 
             <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">yintercept=</span>shannon, <span class="dt">col =</span> ecosystem), <span class="dt">lty =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">labs</a></span>(<span class="dt">y=</span><span class="st">"Shannon index"</span>,<span class="dt">col =</span> <span class="st">""</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/theme">theme</a></span>(<span class="dt">legend.position=</span><span class="st">"none"</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"Estimated true Shannon with error"</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/coord_cartesian">coord_cartesian</a></span>(<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">9</span>))

plot_14_a &lt;-<span class="st"> </span>plot_base +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_continuous">scale_x_continuous</a></span>(<span class="dt">name=</span><span class="st">"Environment"</span>, <span class="dt">breaks=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">2.5</span>)) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_linerange">geom_linerange</a></span>(<span class="dt">data =</span> rarefaction_table %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">substr</span>(type, <span class="dv">1</span>, <span class="dv">8</span>) ==<span class="st"> "estimate"</span>), 
                 <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> ecosystem_number +<span class="st"> </span><span class="kw">c</span>(<span class="kw">seq</span>(-<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dt">length.out =</span> <span class="dv">6</span>), 
                                              <span class="kw">seq</span>(-<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dt">length.out =</span> <span class="dv">5</span>)), <span class="dt">ymin=</span>richness, <span class="dt">ymax =</span> richness_max), <span class="dt">lty =</span> <span class="dv">1</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">labs</a></span>(<span class="dt">y=</span><span class="st">"Taxonomic richness"</span>,<span class="dt">col =</span> <span class="st">""</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/theme">theme</a></span>(<span class="dt">legend.position=</span><span class="st">"none"</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"Estimated true richness with error"</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/coord_cartesian">coord_cartesian</a></span>(<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">7000</span>))

plot_14_b &lt;-<span class="st"> </span>plot_base +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_continuous">scale_x_continuous</a></span>(<span class="dt">name=</span><span class="st">"Environment"</span>, <span class="dt">breaks=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">2.5</span>)) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_linerange">geom_linerange</a></span>(<span class="dt">data =</span> rarefaction_table %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">substr</span>(type, <span class="dv">1</span>, <span class="dv">8</span>) ==<span class="st"> "estimate"</span>), 
                 <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> ecosystem_number +<span class="st"> </span><span class="kw">c</span>(<span class="kw">seq</span>(-<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dt">length.out =</span> <span class="dv">6</span>), 
                                              <span class="kw">seq</span>(-<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dt">length.out =</span> <span class="dv">5</span>)), <span class="dt">ymin=</span>shannon, <span class="dt">ymax =</span> shannon_max), <span class="dt">lty =</span> <span class="dv">1</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">labs</a></span>(<span class="dt">y=</span><span class="st">"Shannon index"</span>,<span class="dt">col =</span> <span class="st">""</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/theme">theme</a></span>(<span class="dt">legend.position=</span><span class="st">"none"</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"Estimated true Shannon with error"</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/coord_cartesian">coord_cartesian</a></span>(<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">9</span>))

plot_6_b &lt;-<span class="st"> </span>plot_base +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">labs</a></span>(<span class="dt">y=</span><span class="st">"Taxonomic richness"</span>,<span class="dt">col =</span> <span class="st">""</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/coord_cartesian">coord_cartesian</a></span>(<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">7000</span>)) +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>(<span class="dt">data =</span> rarefaction_table %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(type ==<span class="st"> "observation"</span>), 
             <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>ecosystem_number+<span class="st"> </span><span class="kw">c</span>(<span class="kw">seq</span>(-<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dt">length.out =</span> <span class="dv">6</span>), 
                                       <span class="kw">seq</span>(-<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dt">length.out =</span> <span class="dv">5</span>)), <span class="dt">y=</span>richness, <span class="dt">col =</span> ecosystem)) +<span class="st"> </span>
<span class="st">  </span><span class="co"># geom_hline(data = rarefaction_table %&gt;% filter(type == "truth"), </span>
<span class="st">  </span><span class="co">#            aes(yintercept=richness, col = ecosystem), lty = 2) +</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"Raw richness"</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_continuous">scale_x_continuous</a></span>(<span class="dt">name=</span><span class="st">"Environment"</span>, <span class="dt">breaks=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">2.5</span>)) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/theme">theme</a></span>(<span class="dt">legend.position=</span><span class="st">"none"</span>) 

plot_6_e &lt;-<span class="st"> </span>plot_base +<span class="st">  </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">labs</a></span>(<span class="dt">y=</span><span class="st">"Shannon diversity"</span>,<span class="dt">col =</span> <span class="st">""</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_continuous">scale_x_continuous</a></span>(<span class="dt">name=</span><span class="st">"Environment"</span>, <span class="dt">breaks=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">2.5</span>)) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>(<span class="dt">data =</span> rarefaction_table %&gt;%<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(type ==<span class="st"> "observation"</span>), 
             <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>ecosystem_number+<span class="st"> </span><span class="kw">c</span>(<span class="kw">seq</span>(-<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dt">length.out =</span> <span class="dv">6</span>), 
                                       <span class="kw">seq</span>(-<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dt">length.out =</span> <span class="dv">5</span>)), <span class="dt">y=</span>shannon, <span class="dt">col =</span> ecosystem)) +<span class="st"> </span>
<span class="st">  </span><span class="co"># geom_hline(data = rarefaction_table %&gt;% filter(type == "truth"), </span>
<span class="st">  </span><span class="co">#            aes(yintercept=shannon, col = ecosystem), lty = 2) +</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/theme">theme</a></span>(<span class="dt">legend.position=</span><span class="st">"none"</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"Raw Shannon index"</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/coord_cartesian">coord_cartesian</a></span>(<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">9</span>)) 

<span class="kw"><a href="http://www.rdocumentation.org/packages/gridExtra/topics/arrangeGrob">grid.arrange</a></span>(<span class="dt">grobs =</span> <span class="kw">list</span>(plot_6_b, plot_6_e, plot_14_a, plot_14_b), 
             <span class="dt">layout_matrix =</span>  <span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="dt">nrow =</span> <span class="dv">2</span>))</code></pre></div>
<p><img src="alpha-better_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Amy Willis, Kathryn Barger, John Bunge.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
